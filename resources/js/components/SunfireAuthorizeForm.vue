<template>
  <div>
    <div class="mb-6 mt-4">
      <form action="#" method="POST">
        <div class="border pb-3 mt-6">
          <div id="terms-and-conditions" @scroll="onScroll" class="text-sm max-h-64 overflow-y-auto overflow-x-hidden p-2">
            <h3 class="text-sm mb-2 text-center font-bold">Terms of Use</h3>
            <h3 class="text-sm mb-2 text-center font-bold">Carefree Insurance Services CareCompare Agent Portal (the “Website”)</h3>

            <p class="text-sm mb-2 mt-6">
              This Website is maintained by Carefree Insurance Services, Inc. and its affiliates (“Company”) as a service
              to  insurance  agents  who  are  contracted  and  appointed  to  sell  Medicare  Advantage  and  Prescription
              Drug Plan insurance and/or other insurance products (“Agent”, “You” or “Your”). By registering for and
              using this Website, You are certifying that You are a licensed and appointed Agent within the hierarchy
              and/or  downline  of  the  Company  and  You  agree  to  the  following  terms  of  use  (“Terms”)  without
              limitation or qualification. Please read these Terms carefully before registering or using this Website. If
              You do not agree with these Terms as updated from time to time, You are not granted permission to use
              this  Website  and  must  exit  it  immediately.  These  Terms  govern  Your  use  of  this  Website,  including
              commission  and  policy  reports,  quote  and  enroll,  e-app,  messages  and  alerts,  business  dashboards,
              updates, new releases and all other content and tools (collectively, the "Website").
            </p>

            <h3 class="text-sm mb-2 mt-6">License Grant and Restrictions </h3>
            <p class="text-sm mb-2">
              This Website is protected by copyright, trade secret, patent and other intellectual property laws. You are
              only  granted  the  right  to  use  this  Website,  and  all  rights  of  ownership  are  reserved  in  the  Website  not
              expressly granted to You. As long as You comply with these Terms, You are granted a personal, limited,
              nonexclusive, nontransferable license to use this Website that is valid only for the period that You are a
              licensed,  appointed  and  contracted  agent  with  the  appropriate  insurance  carriers  and  within  the
              hierarchy  and/or  downline  of  Company  unless  Your  access  is  otherwise  terminated  at  Company’s  sole
              discretion.  For  avoidance  of  doubt,  Company,  within  its  sole  discretion,  reserves  the  right  to  terminate
              Your  access  to  the  Website  at  any  time.  In  addition,  Your  right  to  use  the  Website  is  only  for  the
              purposes  of  providing  insurance  quotes  and  enrollments  to  eligible  applicants  of  Medicare  Advantage
              and/or  Prescription  Drug  Plan  insurance  and/or  other  insurance  products,  tracking  Your  business  and
              commissions and for general use of information and tools related to the sale of insurance products.
            </p>
            <p class="text-sm mb-2">
              You  agree  not  to  use  the  Website  in  a  manner  that  violates  any  applicable  law,  regulation  or  these
              Terms.  For  example,  (and  not  as  an  exhaustive  list  of  examples)  unless  authorized  by  Company  in
              writing, You agree You will not:
            </p>
            <ol class="text-sm mb-2">
              <li>Provide  access  to  the  Website  to  any  third  party  including,  but  not  limited  to,  another Agent. </li>
              <li>Modify,  disrupt  or  interfere  with  the  Website,  supporting  servers  or  networks  either manually or through the use of scripts, viruses, worms or other code. </li>
              <li>Reproduce, duplicate, copy, deconstruct, sell, trade or resell the Website.</li>
              <li>Reproduce,  duplicate,  copy,  deconstruct,  sell,  trade  or  resell  applicant  personal  and/or health   information   obtained   for   the   purpose   of   providing   insurance   quotes   and enrollments through the Website. </li>
              <li>Attempt  to  access  any  other  Company  systems  that  You  do  not  have  permission  to access or use.  </li>
              <li>Excessively overload the Website or Company systems used to support the Website. </li>
            </ol>

            <p class="text-sm mb-2">
              If You violate any of these Terms, Your right to use the Website automatically terminates.
            </p>

            <h3 class="text-sm mb-2 mt-6">Trademarks </h3>
            <p class="text-sm mb-2">
              Company  logos  and  all  other  trademarks,  service  marks,  trade  names,  domain  names,  URLs  and  icons
              ("Marks") appearing on this Website, registered or not, are the property of Company or their respective
              owners. Nothing on this Website grants You any right or license to use any of the Marks on this Website
              without the express written permission of Company. Unauthorized use may violate trademark and other
              laws.
            </p>

            <h3 class="text-sm mb-2 mt-6">Content </h3>
            <p class="text-sm mb-2">
              You agree not to use the Website to upload, post, distribute, link to, publish, reproduce, engage in or
              transmit any of the following, including but not limited to:
            </p>
            <ol class="text-sm mb-2">
              <li>Illegal,   fraudulent,   libelous,   defamatory,   obscene,   pornographic,   profane,   threatening,
                abusive,   hateful,   harassing,   offensive,   inappropriate,   or   objectionable   information   or
                communications of any kind, including without limitation conduct that would encourage or
                constitute  an  attack  or  inflaming  others,  or  criminal  or  civil  liability  under  any  local,  state,
                federal or foreign law; </li>
              <li>Content or data that would impersonate someone else or forging a signature on a document
                or  falsely  represent  Your  identity  or  qualifications,  or  that  constitutes  a  breach  of  any
                individual’s privacy; </li>
              <li>Advertisements,  solicitations,  investment  opportunities,  chain  letters,  pyramid  schemes,
                other unsolicited communication, or engage in spamming or flooding; </li>
              <li>Virus, Trojan horse, worm, or other disruptive or harmful software or data; and </li>
              <li>Any  information,  software  or  content  which  is  not  legally  Yours  and  may  be  protected  by
                copyright or other proprietary right or derivative works. </li>
            </ol>

            <h3 class="text-sm mb-2 mt-6">Additional Items You Agree To</h3>
            <p class="text-sm mb-2">
              Company  may  be  required  by  law  to  send  You  communications  about  the  Website.  You  agree  that  we
              may send these communications to You via e-mail or post them on this Website.
            </p>
            <p class="text-sm mb-2">
              You  are  the  only  person  authorized  to  use  Your  username  and  password  and  for  maintaining  the
              confidentiality  of  Your  username  and  password.  You  shall  not  permit  or  allow  other  persons  to  have
              access  to  or  use  Your  username  and  password,  except  if  You  choose  to  provide  that  information  to
              Company’s authorized technical support personnel to assist You. You are responsible for the use of the
              Website under Your username. If You become aware of any unauthorized access to Your account, theft
              or loss of Your password, You agree to contact Company as soon as possible.
            </p>
            <p class="text-sm mb-2">
              Additionally,  the  Website  may  periodically  be  updated  with  tools,  utilities,  improvements,  third  party
              applications or general updates to improve and enhance the features and performance of the Website.
              You agree to receive these updates automatically.
            </p>
            <p class="text-sm mb-2">
              Company  shall  not  be  liable  for  the  performance  of  the  Website  due  to  causes  beyond  its  reasonable
              control, such as acts of God, natural disasters, terrorist acts, war or other hostilities, labor disputes, civil
              disturbances,  the  actions  or  omissions  of  third  parties,  electrical  or  communication  system  failures  or
              governmental action.
            </p>

            <h3 class="text-sm mb-2 mt-6">Disclaimer of Warranties</h3>
            <p class="text-sm mb-2">
              The use of this Website is entirely at Your own risk, and except as described in these Terms, the Website
              is provided “AS IS.” To the maximum extent permitted by applicable law, Company, and their third party
              service  or  data  providers,  affiliates,  licensors,  distributors  or  suppliers  (collectively  referred  to  as,
              “Suppliers”) disclaim all warranties, express or implied, including any warranty that the Website is fit for
              a   particular   purpose,   title,   merchantability,   non-interference   with   or   non-infringement   of   any
              intellectual property right, or the accuracy, reliability, quality or content in or linked to the Website. The
              data  provided  on  the  Website  is  for  informational  purposes  only,  and  no  warranty  is  made  that  the
              information is error-free. Rate information provided on this Website is not a final offer to sell insurance.
              Please note that once You leave this Website or arrive at this Website from another location, either by
              using a link provided for Your convenience or by specifying Your own destination, Company accepts no
              responsibility for the content, products and/or services provided at these locations. Company does not
              control, endorse, promote or have any affiliation with any other website unless expressly stated herein.
              Company does not warrant that Your use of the Website will satisfy or ensure compliance with any legal
              obligations or laws or regulations. This disclaimer applies to, but is not limited to, the Health Insurance
              Portability   and   Accountability   Act   of   1996   (“HIPAA”),   The   Gramm-Leach-Bliley   Act   of   1999,   The
              Sarbanes-Oxley Act of 2002, or other Federal or State statutes or regulations. You are solely responsible
              for ensuring that Your use of the Website is in accordance with applicable law.
            </p>

            <h3 class="text-sm mb-2 mt-6">Limitation of Liability and Indemnification</h3>
            <p class="text-sm mb-2">
              IN NO EVENT WILL COMPANY BE LIABLE TO ANY PARTY FOR ANY DIRECT, INDIRECT, SPECIAL OR OTHER
              CONSEQUENTIAL DAMAGES ARISING OUT OF ANY USE OF THIS WEBSITE, OR ANY OTHER HYPER-LINKED
              WEBSITE,  INCLUDING,  WITHOUT  LIMITATION,  ANY  LOST  PROFITS,  BUSINESS  INTERRUPTION,  LOSS  OF
              PROGRAMS OR DATA ON YOUR EQUIPMENT, OR OTHERWISE, EVEN IF WE ARE EXPRESSLY ADVISED OF
              THE POSSIBILITY OR LIKELIHOOD OF SUCH DAMAGES.
            </p>
            <p class="text-sm mb-2">
              You  agree  to  indemnify  and  hold  Company  and  their  affiliates  and  Suppliers  harmless  from  any  and  all
              claims,  liability  and expenses,  including reasonable attorneys'  fees  and costs,  arising out of Your  use of
              the  Website  or  Your  breach  of  these  Terms  (collectively,  "Claims").  Company  reserves  the  right,  in  its
              sole discretion and at its own expense, to assume the exclusive defense and control of any Claims. You
              agree to reasonably cooperate as requested by Company in the defense of any Claims.
            </p>

            <h3 class="text-sm mb-2 mt-6">Changes to These Terms of Use</h3>
            <p class="text-sm mb-2">
              We  may  change  these  Terms  from  time  to  time  and  the  changes  will  be  effective  when  posted  on  this
              Website or when we notify You by other means. Please review these Terms periodically on this Website
              for  changes.  Your  continued  use  of  the  Website  after  the  Company  posts  or  otherwise  notifies  You  of
              any changes indicates Your agreement to the changes.
            </p>

            <h3 class="text-sm mb-2 mt-6">Termination</h3>
            <p class="text-sm mb-2">
              Company may immediately and without notice terminate or suspend Your access to the Website. Upon
              release  from  Company’s  downline  and/or  hierarchy,  You  must  immediately  stop  using  the  Website.  In
              addition, Company may in its sole discretion discontinue the Website at any time without notice.
            </p>

            <h3 class="text-sm mb-2 mt-6">Privacy of Personal Information</h3>
            <p class="text-sm mb-2">
              You are responsible for protecting the information on Your computer by encrypting data, installing anti-
              virus  software,  updating  Your  software,  password  protecting  your  files,  and  not  permitting  third  party
              physical or electronic access to Your computer.
            </p>

            <h3 class="text-sm mb-2 mt-6">Miscellaneous </h3>
            <p class="text-sm mb-2">
              Except  as  may  be  limited  by  the  Terms,  these  Terms  are  the  entire  agreement  between  You  and  the
              Company  and  replace  all  prior  understandings,  communications  and  agreements,  oral  or  written,
              regarding  its  subject  matter.  These  Terms  set  forth  the  entire  liability  of  the  Company  and  their
              Suppliers and Your exclusive remedy with respect to the Website and its use. If any court of law having
              the  jurisdiction  rules  that  any  part(s)  of  these  Terms  are  invalid,  that  section  will  be  removed  without
              affecting the remainder of the Terms. The remaining Terms will be valid and enforceable
            </p>
            <p class="text-sm mb-2 mt-6" ref="lastParagraph">
              You  cannot  assign  or  transfer  these  Terms  to  anyone  without  the  prior  written  approval  of  Company.
              However, Company may assign or transfer these Terms without Your consent to (a) a parent company or
              direct  or  indirect  subsidiary,  (b)  another  company  through  a  sale  of  assets  by  Company,  or  (c)  a
              successor by merger. Any assignment in violation of this section shall be void.
            </p>

            <p class="text-right text-sm ">Version date: June 1, 2020</p>
          </div>
        </div>

        <div class="mt-4 flex items-center justify-between">
          <div class="flex items-center">
            <input
              id="remember_me"
              type="checkbox"
              class="form-checkbox h-4 w-4 text-indigo-600 transition duration-150 ease-in-out"
              v-model="acceptedTermsConditions"
              :disabled="!hasReadTerms"
              :class="{'opacity-50 cursor-not-allowed' : !hasReadTerms}"
            />

            <label for="remember_me" class="ml-2 block text-sm leading-5 text-gray-900">
              I agree to the above terms and conditions
            </label>
          </div>
        </div>

        <div class="mt-6">
          <label for="name" class="block text-sm font-medium leading-5 text-gray-700">
            Type your name below. (eSign)
          </label>
          <div class="mt-2 rounded-md shadow-sm">
            <input
              id="name"
              type="text"
              v-model="name"
              class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:shadow-outline-blue focus:border-blue-300 transition duration-150 ease-in-out sm:text-sm sm:leading-5"
            />
          </div>
        </div>
      </form>
    </div>

    <div class="flex justify-end items-center mt-4 font-semibold">
      <form @submit="submit" method="post" action="/oauth/authorize">
        <input type="hidden" name="state" :value="state">
        <input type="hidden" name="client_id" :value="clientId">
        <slot name="csrfAuthorize" />
        <button class="relative rounded-full py-1 px-3 text-white bg-mmablue border-mmablue text-sm mr-3 border text-sm" :disabled="!canSubmit"
                :class="{'opacity-50 cursor-not-allowed' : !canSubmit, 'btn-loading' : loading}">
          <span class="block">Authorize</span>
        </button>
      </form>

      <form method="delete" action="/oauth/authorize">
        <slot name="csrfDelete" />
        <input type="hidden" name="state" :value="state">
        <input type="hidden" name="client_id" :value="clientId">
        <button
          class="rounded-full text-red-custom py-1 flex items-center font-montserrat text-sm px-3">
          Cancel
        </button>
      </form>
    </div>
  </div>
</template>

<script>
  // import axios from 'axios'

  export default {
    props: {
      state: {required: true, type: String},
      clientId: {required: true, type: String}
    },
    name: 'SunfireAuthorizeForm',
    data: () => ({
      hasReadTerms: false,
      acceptedTermsConditions: false,
      name: '',
      loading: false,
    }),
    computed: {
      canSubmit () {
        return this.acceptedTermsConditions && this.name.length > 2
      }
    },
    methods: {
      onScroll ({target: {scrollTop, clientHeight, scrollHeight}}) {
        const isLastParagraph = this.isInViewport(this.$refs.lastParagraph)
        
        if (scrollTop + clientHeight >= scrollHeight - 2 || isLastParagraph) {
          this.hasReadTerms = true
        }
      },
      async submit (e) {
        this.loading = true
        // await axios.get('/v3/sunfire-authorize')
        //   .catch(() => {
        //     e.preventDefault()
        //   })
        //   .finally(() => {
        //     this.loading = false
        //   })
        return true
      },
      isInViewport(elem) {
        const  distance = elem.getBoundingClientRect();
        return (
          distance.top >= 0 &&
          distance.left >= 0 &&
          distance.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
          distance.right <= (window.innerWidth || document.documentElement.clientWidth)
        )
      }
    }
  }
</script>

<style scoped>
  .btn-loading {
    pointer-events: none;
  }

  .btn-loading span {
    pointer-events: none;
    color: transparent !important;
  }

  .btn-loading:before {
    content: '';
    display: block;
    width: 1em;
    height: 1em;
    border-width: 2px;
    border-color: currentColor;
    border-style: solid;
    border-right-color: transparent;
    border-top-color: transparent;
    position: absolute;
    left: calc(50% - (1em / 2));
    top: calc(50% - (1em / 2));
    border-radius: 50%;
    animation: rotate 0.5s infinite linear;
  }

  @keyframes rotate {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }
</style>
